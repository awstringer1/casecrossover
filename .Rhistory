getNodes(thetagrid)
opt <- optimize_all_thetas_parallel(thetagrid,
model_data,
optcontrol = model_data$control$opt_control,
doparallel = model_data$control$doparallel)
source('~/phd/projects/case-crossover/rpkg/casecrossover/R/06-casecrossover.R')
cc1 <- casecrossover(case1 ~ x + strata(id),sampledata)
cc2 <- casecrossover(case2 ~ x + strata(id),sampledata)
cc3 <- casecrossover(case1 ~ s(x) + strata(id),sampledata,controlsmooth)
cc4 <- casecrossover(case2 ~ s(x) + strata(id),sampledata,controlsmooth)
cc5 <- casecrossover(case1 ~ x + s(x) + strata(id),sampledata,controlsmooth)
cc6 <- casecrossover(case2 ~ x + s(x) + strata(id),sampledata,controlsmooth)
cc7 <- casecrossover(case1 ~ s(x) + s(x2) + strata(id),sampledata,controlsmooth2)
cc8 <- casecrossover(case2 ~ s(x) + s(x2) + strata(id),sampledata,controlsmooth2)
cc9 <- casecrossover(case1 ~ s(x) + s(x2) + poly(x,2,raw = TRUE) + poly(x2,3,raw=TRUE) + strata(id),sampledata,controlsmooth2)
cc10 <- casecrossover(case2 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth2)
cc11 <- casecrossover(case1 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth3)
cc13 <- model_setup(case1 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth4)
formula <- case1 ~ x + strata(id)
data <- sampledata
control = cc_default_control()
if (verbose) cat("Setting up model...\n")
model_data <- model_setup(formula,data,control)
# Sort the data by id, case
if (verbose) cat("Sorting data...\n")
data <- data %>% dplyr::arrange(.data[[model_data$model_elements$strata]],.data[[model_data$model_elements$response]])
K <- length(model_data$model_elements$smooth)
K
mvQuad::createNIGrid(dim = 1,type = "GLe",level = 1)
thetagrid <- mvQuad::createNIGrid(dim = 1,type = "GLe",level = 1)
getNodes(thetagrid)
source('~/phd/projects/case-crossover/rpkg/casecrossover/R/06-casecrossover.R')
cc1 <- casecrossover(case1 ~ x + strata(id),sampledata)
cc2 <- casecrossover(case2 ~ x + strata(id),sampledata)
cc3 <- casecrossover(case1 ~ s(x) + strata(id),sampledata,controlsmooth)
cc4 <- casecrossover(case2 ~ s(x) + strata(id),sampledata,controlsmooth)
cc5 <- casecrossover(case1 ~ x + s(x) + strata(id),sampledata,controlsmooth)
cc6 <- casecrossover(case2 ~ x + s(x) + strata(id),sampledata,controlsmooth)
cc7 <- casecrossover(case1 ~ s(x) + s(x2) + strata(id),sampledata,controlsmooth2)
cc8 <- casecrossover(case2 ~ s(x) + s(x2) + strata(id),sampledata,controlsmooth2)
cc9 <- casecrossover(case1 ~ s(x) + s(x2) + poly(x,2,raw = TRUE) + poly(x2,3,raw=TRUE) + strata(id),sampledata,controlsmooth2)
cc10 <- casecrossover(case2 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth2)
cc11 <- casecrossover(case1 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth3)
cc13 <- model_setup(case1 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth4)
opt_9 <- optimize_all_thetas_parallel(thetagrid2,model_data9,optcontrol = optcontrol)
logpost9 <- add_log_posterior_values(opt_9,model_data9)
posthoc9 <- compute_marginal_means_and_variances(logpost9,model_data9)
posthoc9
formula <- case1 ~ s(x) + s(x2) + poly(x,2,raw = TRUE) + poly(x2,3,raw=TRUE) + strata(id)
data <- sampledata
control = controlsmooth2
model_data <- model_setup(formula,data,control)
# Sort the data by id, case
if (verbose) cat("Sorting data...\n")
data <- data %>% dplyr::arrange(.data[[model_data$model_elements$strata]],.data[[model_data$model_elements$response]])
# Choose the theta grid
# TODO: add this to control
if (verbose) cat("Creating the grid for numerical integration of theta posterior...\n")
K <- length(model_data$model_elements$smooth)
if (K == 0) {
# Create a blank grid as a placeholder
thetagrid <- mvQuad::createNIGrid(dim = 1,type = "GLe",level = 1)
} else {
thetagrid <- mvQuad::createNIGrid(dim = K,type = "GLe",level = model_data$control$thetaaccuracy)
mvQuad::rescale(thetagrid,domain = matrix(c(rep(-10,K),rep(10,K)),ncol=K))
}
# Optimization
if (verbose) cat("Performing optimization...\n")
opt <- optimize_all_thetas_parallel(thetagrid,
model_data,
optcontrol = model_data$control$opt_control,
doparallel = model_data$control$doparallel)
opt
opt$theta
posthoc <- compute_marginal_means_and_variances(opt,model_data)
model_results <- opt
i = NULL
constrA = NULL
lincomb = NULL
if (is.null(i)) i <- get_indices(model_data)
if (class(i) == "ccindex") {
idx <- c(i$smooth,i$linear)
} else if (is.numeric(i)) {
idx <- i
} else {
stop(stringr::str_c("i must be an object of class ccindex, or a numeric vector. You provided an object of class ",class(i)))
}
idx <- unname(idx)
# Pull constraints from model_data
if (is.null(constrA)) {
# Check if model has any linear constraints
if (!is.null(model_data$control$linear_constraints)) {
if (length(model_data$control$linear_constraints) > 0) {
constrA <- make_linear_constraints(model_data)
}
}
} else if (!constrA) {
# If constrA is FALSE, nullify it now
constrA <- NULL
} else {
if (!inherits(constrA,"sparseMatrix")) {
stop("constrA must either be NULL, logical, or an object inheriting from sparseMatrix")
}
}
# Pull linear combinations from model data
if (is.null(lincomb)) {
# Check if the model has both linear and smooth terms for the SAME covariate
if (length(intersect(model_data$model_elements$smooth,model_data$model_elements$linear)) > 0) {
lincomb <- make_model_lincombs(model_data)
}
} else if (is.logical(lincomb)) {
# If lincomb set to FALSE, nullify it now
if (!lincomb) lincomb <- NULL
} else {
if (!inherits(lincomb,"sparseMatrix")) {
stop("lincomb must either be NULL, logical, or an object inheriting from sparseMatrix")
}
}
constrA
lincomb
nrow(model_results) > 1
if (nrow(model_results) > 1) {
# Add log posterior values for theta if not present
if (!("theta_logposterior" %in% names(model_results))) {
model_results <- add_log_posterior_values(model_results,model_data)
}
# Normalize
thetanormconst <- normalize_log_posterior(model_results$theta_logposterior,attributes(model_results)$thetagrid)
model_results$theta_logposterior <- model_results$theta_logposterior - thetanormconst
# Note that doing this still leaves sigma_logposterior unnormalized! But it's not used in this function.
# Get the integration weights
# dx1 <- diff(model_results$theta) # dx1[i] = x[i+1] - x[i]
# ld <- length(dx1)
# intweights <- c(
#   dx1[1]/2,
#   (dx1[1:(ld-1)] + dx1[2:ld])/2,
#   dx1[ld]/2
# )
intweights <- mvQuad::getWeights(attributes(model_results)$thetagrid)[ ,1]
}
intweights
mvQuad::getNodes(attributes(model_results)$thetagrid)
# Compute the precision matrices for each theta
precision_matrices <- model_results %>%
purrr::pmap(~list(Q = Q_matrix(theta = ..1,model_data = model_data),
theta = ..1)
)
# Compute the hessians for each theta
hessian_structure <- hessian_log_likelihood_structure(W = model_results$solution[[1]],model_data = model_data)
hessians <- model_results %>%
purrr::pmap(~list(
C = hessian_log_likelihood(W = ..4,model_data = model_data,structure = hessian_structure),
theta = ..1)
)
precision_matrices
precision_matrices %>% map("Q") %>% map(rankMatrix)
model_data$vectorofcolumnstoremove
model_data$Wd
precision_matrices %>% map("Q") %>% map(dim)
rm(list=ls())
devtools::test()
devtools::test()
ls()
source('~/phd/projects/case-crossover/rpkg/casecrossover/R/00-diag-of-inv.R')
source('~/phd/projects/case-crossover/rpkg/casecrossover/R/00-prior-definitions.R')
source('~/phd/projects/case-crossover/rpkg/casecrossover/R/00-utils.R')
source('~/phd/projects/case-crossover/rpkg/casecrossover/R/04-optimization.R')
source('~/phd/projects/case-crossover/rpkg/casecrossover/R/02-likelihood.R')
source('~/phd/projects/case-crossover/rpkg/casecrossover/R/03-latent-variables.R')
source('~/phd/projects/case-crossover/rpkg/casecrossover/R/01-model-setup.R')
source('~/phd/projects/case-crossover/rpkg/casecrossover/R/05-posthoc-quantities.R')
# Create example data for use in testthat tests.
sampledata <- dplyr::tibble(
id = c(1,1,1,2,2),
case1 = c(0,0,1,0,1),
case2 = c(0,0,2,0,2),
x = c(1,2,3,1,2),
x2 = c(6,2,8,1,0)
)
ff1 <- case1 ~ x + strata(id)
controlsmooth <- cc_control(smooth_prior = list(pc_prior(3,.75)),
linear_constraints = create_linear_constraints(u = sampledata$x,
whichzero = 1,
nm = "x"))
controlsmooth2 <- cc_control(
smooth_prior = list(
pc_prior(3,.75),
pc_prior(5,.1)
),
linear_constraints = c(
create_linear_constraints(u = sampledata$x,
whichzero = 1,
nm = "x"),
create_linear_constraints(u = sampledata$x2,
whichzero = 2,
nm = "x2")
)
)
controlsmooth3 <- cc_control(
smooth_prior = list(
pc_prior(3,.75),
pc_prior(5,.1)
),
linear_constraints = c(
create_linear_constraints(u = sampledata$x,
whichzero = 1,
nm = "x"),
create_linear_constraints(u = sampledata$x2,
whichzero = c(2,6),
nm = "x2")
)
)
controlsmooth4 <- cc_control(
smooth_prior = list(
pc_prior(3,.75),
pc_prior(5,.1)
),
linear_constraints = c(
create_linear_constraints(u = sampledata$x,
whichzero = c(1,2),
nm = "x"),
create_linear_constraints(u = sampledata$x2,
whichzero = c(2,6),
nm = "x2")
)
)
model_data1 <- model_setup(case1 ~ x + strata(id),sampledata)
model_data2 <- model_setup(case2 ~ x + strata(id),sampledata)
model_data3 <- model_setup(case1 ~ s(x) + strata(id),sampledata,controlsmooth)
model_data4 <- model_setup(case2 ~ s(x) + strata(id),sampledata,controlsmooth)
model_data5 <- model_setup(case1 ~ x + s(x) + strata(id),sampledata,controlsmooth)
model_data6 <- model_setup(case2 ~ x + s(x) + strata(id),sampledata,controlsmooth)
model_data7 <- model_setup(case1 ~ s(x) + s(x2) + strata(id),sampledata,controlsmooth2)
model_data8 <- model_setup(case2 ~ s(x) + s(x2) + strata(id),sampledata,controlsmooth2)
model_data9 <- model_setup(case1 ~ s(x) + s(x2) + poly(x,2,raw = TRUE) + poly(x2,3,raw=TRUE) + strata(id),sampledata,controlsmooth2)
model_data10 <- model_setup(case2 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth2)
model_data11 <- model_setup(case1 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth3)
model_data13 <- model_setup(case1 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth4)
library(Matrix)
# Create example data for use in testthat tests.
sampledata <- dplyr::tibble(
id = c(1,1,1,2,2),
case1 = c(0,0,1,0,1),
case2 = c(0,0,2,0,2),
x = c(1,2,3,1,2),
x2 = c(6,2,8,1,0)
)
ff1 <- case1 ~ x + strata(id)
controlsmooth <- cc_control(smooth_prior = list(pc_prior(3,.75)),
linear_constraints = create_linear_constraints(u = sampledata$x,
whichzero = 1,
nm = "x"))
controlsmooth2 <- cc_control(
smooth_prior = list(
pc_prior(3,.75),
pc_prior(5,.1)
),
linear_constraints = c(
create_linear_constraints(u = sampledata$x,
whichzero = 1,
nm = "x"),
create_linear_constraints(u = sampledata$x2,
whichzero = 2,
nm = "x2")
)
)
controlsmooth3 <- cc_control(
smooth_prior = list(
pc_prior(3,.75),
pc_prior(5,.1)
),
linear_constraints = c(
create_linear_constraints(u = sampledata$x,
whichzero = 1,
nm = "x"),
create_linear_constraints(u = sampledata$x2,
whichzero = c(2,6),
nm = "x2")
)
)
controlsmooth4 <- cc_control(
smooth_prior = list(
pc_prior(3,.75),
pc_prior(5,.1)
),
linear_constraints = c(
create_linear_constraints(u = sampledata$x,
whichzero = c(1,2),
nm = "x"),
create_linear_constraints(u = sampledata$x2,
whichzero = c(2,6),
nm = "x2")
)
)
model_data1 <- model_setup(case1 ~ x + strata(id),sampledata)
model_data2 <- model_setup(case2 ~ x + strata(id),sampledata)
model_data3 <- model_setup(case1 ~ s(x) + strata(id),sampledata,controlsmooth)
model_data4 <- model_setup(case2 ~ s(x) + strata(id),sampledata,controlsmooth)
model_data5 <- model_setup(case1 ~ x + s(x) + strata(id),sampledata,controlsmooth)
model_data6 <- model_setup(case2 ~ x + s(x) + strata(id),sampledata,controlsmooth)
model_data7 <- model_setup(case1 ~ s(x) + s(x2) + strata(id),sampledata,controlsmooth2)
model_data8 <- model_setup(case2 ~ s(x) + s(x2) + strata(id),sampledata,controlsmooth2)
model_data9 <- model_setup(case1 ~ s(x) + s(x2) + poly(x,2,raw = TRUE) + poly(x2,3,raw=TRUE) + strata(id),sampledata,controlsmooth2)
model_data10 <- model_setup(case2 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth2)
model_data11 <- model_setup(case1 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth3)
model_data13 <- model_setup(case1 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth4)
cc1 <- casecrossover(case1 ~ x + strata(id),sampledata)
source('~/phd/projects/case-crossover/rpkg/casecrossover/R/06-casecrossover.R')
cc1 <- casecrossover(case1 ~ x + strata(id),sampledata)
# formula <- case1 ~ s(x) + s(x2) + poly(x,2,raw = TRUE) + poly(x2,3,raw=TRUE) + strata(id)
formula <- case1 ~ x + strata(id)
data <- sampledata
# control = controlsmooth2
control = cc_default_control()
if (verbose) cat("Setting up model...\n")
model_data <- model_setup(formula,data,control)
# Sort the data by id, case
if (verbose) cat("Sorting data...\n")
data <- data %>% dplyr::arrange(.data[[model_data$model_elements$strata]],.data[[model_data$model_elements$response]])
verbose <- TRUE
if (verbose) cat("Setting up model...\n")
model_data <- model_setup(formula,data,control)
# Sort the data by id, case
if (verbose) cat("Sorting data...\n")
data <- data %>% dplyr::arrange(.data[[model_data$model_elements$strata]],.data[[model_data$model_elements$response]])
data
if (verbose) cat("Creating the grid for numerical integration of theta posterior...\n")
K <- length(model_data$model_elements$smooth)
thetagrid <- mvQuad::createNIGrid(dim = 1,type = "GLe",level = 1)
if (verbose) cat("Performing optimization...\n")
opt <- optimize_all_thetas_parallel(thetagrid,
model_data,
optcontrol = model_data$control$opt_control,
doparallel = model_data$control$doparallel)
opt
posthoc <- compute_marginal_means_and_variances(opt,model_data)
source('~/phd/projects/case-crossover/rpkg/casecrossover/R/05-posthoc-quantities.R')
cc1 <- casecrossover(case1 ~ x + strata(id),sampledata)
cc1
cc2 <- casecrossover(case2 ~ x + strata(id),sampledata)
cc3 <- casecrossover(case1 ~ s(x) + strata(id),sampledata,controlsmooth)
cc4 <- casecrossover(case2 ~ s(x) + strata(id),sampledata,controlsmooth)
cc5 <- casecrossover(case1 ~ x + s(x) + strata(id),sampledata,controlsmooth)
cc6 <- casecrossover(case2 ~ x + s(x) + strata(id),sampledata,controlsmooth)
cc7 <- casecrossover(case1 ~ s(x) + s(x2) + strata(id),sampledata,controlsmooth2)
cc8 <- casecrossover(case2 ~ s(x) + s(x2) + strata(id),sampledata,controlsmooth2)
cc9 <- casecrossover(case1 ~ s(x) + s(x2) + poly(x,2,raw = TRUE) + poly(x2,3,raw=TRUE) + strata(id),sampledata,controlsmooth2)
cc10 <- casecrossover(case2 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth2)
cc11 <- casecrossover(case1 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth3)
cc13 <- model_setup(case1 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth4)
cc13 <- casecrossover(case1 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth4)
cc13
length(cc1)
devtools::test()
devtools::check()
devtools::check()
logpost9
# Create example data for use in testthat tests.
sampledata <- dplyr::tibble(
id = c(1,1,1,2,2),
case1 = c(0,0,1,0,1),
case2 = c(0,0,2,0,2),
x = c(1,2,3,1,2),
x2 = c(6,2,8,1,0)
)
ff1 <- case1 ~ x + strata(id)
controlsmooth <- cc_control(smooth_prior = list(pc_prior(3,.75)),
linear_constraints = create_linear_constraints(u = sampledata$x,
whichzero = 1,
nm = "x"))
controlsmooth2 <- cc_control(
smooth_prior = list(
pc_prior(3,.75),
pc_prior(5,.1)
),
linear_constraints = c(
create_linear_constraints(u = sampledata$x,
whichzero = 1,
nm = "x"),
create_linear_constraints(u = sampledata$x2,
whichzero = 2,
nm = "x2")
)
)
controlsmooth3 <- cc_control(
smooth_prior = list(
pc_prior(3,.75),
pc_prior(5,.1)
),
linear_constraints = c(
create_linear_constraints(u = sampledata$x,
whichzero = 1,
nm = "x"),
create_linear_constraints(u = sampledata$x2,
whichzero = c(2,6),
nm = "x2")
)
)
controlsmooth4 <- cc_control(
smooth_prior = list(
pc_prior(3,.75),
pc_prior(5,.1)
),
linear_constraints = c(
create_linear_constraints(u = sampledata$x,
whichzero = c(1,2),
nm = "x"),
create_linear_constraints(u = sampledata$x2,
whichzero = c(2,6),
nm = "x2")
)
)
model_data1 <- model_setup(case1 ~ x + strata(id),sampledata)
model_data2 <- model_setup(case2 ~ x + strata(id),sampledata)
model_data3 <- model_setup(case1 ~ s(x) + strata(id),sampledata,controlsmooth)
model_data4 <- model_setup(case2 ~ s(x) + strata(id),sampledata,controlsmooth)
model_data5 <- model_setup(case1 ~ x + s(x) + strata(id),sampledata,controlsmooth)
model_data6 <- model_setup(case2 ~ x + s(x) + strata(id),sampledata,controlsmooth)
model_data7 <- model_setup(case1 ~ s(x) + s(x2) + strata(id),sampledata,controlsmooth2)
model_data8 <- model_setup(case2 ~ s(x) + s(x2) + strata(id),sampledata,controlsmooth2)
model_data9 <- model_setup(case1 ~ s(x) + s(x2) + poly(x,2,raw = TRUE) + poly(x2,3,raw=TRUE) + strata(id),sampledata,controlsmooth2)
model_data10 <- model_setup(case2 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth2)
model_data11 <- model_setup(case1 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth3)
model_data13 <- model_setup(case1 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth4)
# Optimization
optcontrol <- cc_control()$opt_control # Defaults
optcontrol$report.freq = 0
optcontrol$report.level = 0
sink("./tmpoutput07687")
opt_single_1_1 <- optimize_latentfield_trustoptim(0,model_data1,optcontrol = optcontrol)
opt_single_1_2 <- optimize_latentfield_trustoptim(-10,model_data1,optcontrol = optcontrol)
opt_single_2_1 <- optimize_latentfield_trustoptim(0,model_data2,optcontrol = optcontrol)
opt_single_2_2 <- optimize_latentfield_trustoptim(-10,model_data2,optcontrol = optcontrol)
opt_single_3_1 <- optimize_latentfield_trustoptim(0,model_data3,optcontrol = optcontrol)
opt_single_3_2 <- optimize_latentfield_trustoptim(-10,model_data3,optcontrol = optcontrol)
opt_single_4_1 <- optimize_latentfield_trustoptim(0,model_data4,optcontrol = optcontrol)
opt_single_4_2 <- optimize_latentfield_trustoptim(-10,model_data4,optcontrol = optcontrol)
opt_single_5_1 <- optimize_latentfield_trustoptim(0,model_data5,optcontrol = optcontrol)
opt_single_5_2 <- optimize_latentfield_trustoptim(-10,model_data5,optcontrol = optcontrol)
opt_single_6_1 <- optimize_latentfield_trustoptim(0,model_data6,optcontrol = optcontrol)
opt_single_6_2 <- optimize_latentfield_trustoptim(-10,model_data6,optcontrol = optcontrol)
opt_single_7_1 <- optimize_latentfield_trustoptim(c(0,0),model_data7,optcontrol = optcontrol)
opt_single_7_2 <- optimize_latentfield_trustoptim(c(-10,-10),model_data7,optcontrol = optcontrol)
opt_single_8_1 <- optimize_latentfield_trustoptim(c(0,0),model_data8,optcontrol = optcontrol)
opt_single_8_2 <- optimize_latentfield_trustoptim(c(-10,-10),model_data8,optcontrol = optcontrol)
opt_single_9_1 <- optimize_latentfield_trustoptim(c(0,0),model_data9,optcontrol = optcontrol)
opt_single_9_2 <- optimize_latentfield_trustoptim(c(-10,-10),model_data9,optcontrol = optcontrol)
opt_single_10_1 <- optimize_latentfield_trustoptim(c(0,0),model_data10,optcontrol = optcontrol)
opt_single_10_2 <- optimize_latentfield_trustoptim(c(-10,-10),model_data10,optcontrol = optcontrol)
opt_single_11_1 <- optimize_latentfield_trustoptim(c(0,0),model_data11,optcontrol = optcontrol)
opt_single_11_2 <- optimize_latentfield_trustoptim(c(-10,-10),model_data11,optcontrol = optcontrol)
opt_single_13_1 <- optimize_latentfield_trustoptim(c(0,0),model_data13,optcontrol = optcontrol)
opt_single_13_2 <- optimize_latentfield_trustoptim(c(-10,-10),model_data13,optcontrol = optcontrol)
file.remove("./tmpoutput07687")
sink()
# thetagrid1 <- list(
#   c(0),c(1),c(-1)
# )
#
# thetagrid2 <- list(
#   c(0,0),c(1,1),c(-1,-1)
# )
thetagrid1 <- mvQuad::createNIGrid(dim = 1,type = "GLe",level = 3)
mvQuad::rescale(thetagrid1,domain = matrix(c(-1,1),ncol=1))
thetagrid2 <- mvQuad::createNIGrid(dim = 2,type = "GLe",level = 3)
mvQuad::rescale(thetagrid2,domain = matrix(c(-1,-1,1,1),ncol=2))
sink("./tmpoutput07687")
opt_1 <- optimize_all_thetas_parallel(thetagrid1,model_data1,optcontrol = optcontrol)
opt_2 <- optimize_all_thetas_parallel(thetagrid1,model_data2,optcontrol = optcontrol)
opt_3 <- optimize_all_thetas_parallel(thetagrid1,model_data3,optcontrol = optcontrol)
opt_4 <- optimize_all_thetas_parallel(thetagrid1,model_data4,optcontrol = optcontrol)
opt_5 <- optimize_all_thetas_parallel(thetagrid1,model_data5,optcontrol = optcontrol)
opt_6 <- optimize_all_thetas_parallel(thetagrid1,model_data6,optcontrol = optcontrol)
opt_7 <- optimize_all_thetas_parallel(thetagrid2,model_data7,optcontrol = optcontrol)
opt_8 <- optimize_all_thetas_parallel(thetagrid2,model_data8,optcontrol = optcontrol)
opt_9 <- optimize_all_thetas_parallel(thetagrid2,model_data9,optcontrol = optcontrol)
opt_10 <- optimize_all_thetas_parallel(thetagrid2,model_data10,optcontrol = optcontrol)
opt_11 <- optimize_all_thetas_parallel(thetagrid2,model_data11,optcontrol = optcontrol)
opt_13 <- optimize_all_thetas_parallel(thetagrid2,model_data13,optcontrol = optcontrol)
file.remove("./tmpoutput07687")
sink()
# Add log-posteriors
logpost1 <- add_log_posterior_values(opt_1,model_data1)
logpost2 <- add_log_posterior_values(opt_2,model_data2)
logpost3 <- add_log_posterior_values(opt_3,model_data3)
logpost4 <- add_log_posterior_values(opt_4,model_data4)
logpost5 <- add_log_posterior_values(opt_5,model_data5)
logpost6 <- add_log_posterior_values(opt_6,model_data6)
logpost7 <- add_log_posterior_values(opt_7,model_data7)
logpost8 <- add_log_posterior_values(opt_8,model_data8)
logpost9 <- add_log_posterior_values(opt_9,model_data9)
logpost10 <- add_log_posterior_values(opt_10,model_data10)
logpost11 <- add_log_posterior_values(opt_11,model_data11)
logpost13 <- add_log_posterior_values(opt_13,model_data13)
parse_formula(case2 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id))
parse_formula(case1 ~ s(x) + s(x2) + poly(x,2,raw = TRUE) + poly(x2,3,raw=TRUE) + strata(id))
cc10 <- casecrossover(case2 ~ s(x) + s(x2) + poly(x,2,raw = TRUE) + poly(x2,3,raw = TRUE) + strata(id),sampledata,controlsmooth2)
sampledata
cc9 <- casecrossover(case1 ~ s(x) + s(x2) + poly(x,2) + poly(x2,3) + strata(id),sampledata,controlsmooth2)
cc9 <- casecrossover(case1 ~ s(x) + s(x2) + poly(x,2,raw = TRUE) + poly(x2,3,raw = TRUE) + strata(id),sampledata,controlsmooth2)
parse_formula()
parse_formula
model_data9$X
model_data9$Xd
model_data10$X
model_data10$Xd
rankMatrix(model_data9$X)
rankMatrix(model_data9$Xd)
rankMatrix(model_data10$Xd)
rankMatrix(model_data10$X)
devtools::check()
rm(list=ls())
